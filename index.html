<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>0차 지인의 팔로잉 입력</title>
  <style>
    body {
      background-color: white;
      color: #333;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
    }
    h1 {
      font-size: 24px;
      font-weight: bold;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-top: 10px;
      font-size: 14px;
      padding: 10px;
    }
    button {
      background-color: #888;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      margin-top: 10px;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
    a#download-link {
      display: none;
      margin-top: 15px;
      font-weight: bold;
      color: #2a5885;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>0차 지인의 팔로잉 입력</h1>
  <p>트위터에서 복사한 팔로잉 목록을 아래에 붙여넣으세요.</p>
  <textarea id="input" placeholder="예시:\n홍길동\n@hong123\n나를 팔로우합니다\n..."></textarea>
  <br>
  <button onclick="generateChecker()">확인기 만들기</button>
  <br>
  <a id="download-link" download="checker.html"></a>

  <script>
    function generateChecker() {
      console.log('generateChecker 호출됨');
      
      const input = document.getElementById('input').value;
      if (!input.trim()) {
        alert('입력된 내용이 없습니다!');
        return;
      }
      
      const lines = input.split('\n');
      const accounts = [];
      
      for (let i = 0; i < lines.length; i++) {
        if (lines[i + 2] && lines[i + 2].includes('나를 팔로우합니다')) {
          const name = lines[i]?.trim() || '';
          const username = lines[i + 1]?.trim() || '';
          if (name && username) {
            accounts.push({name: name, username: username});
          }
        }
      }

      if (accounts.length === 0) {
        alert('팔로잉 계정을 찾을 수 없습니다. 형식을 확인해주세요.');
        return;
      }

      console.log('계정 수:', accounts.length);

      // 데이터 처리
      const dataString = JSON.stringify(accounts);
      const encodedData = btoa(encodeURIComponent(dataString));
      
      // 새 문서 생성
      const newDoc = document.implementation.createHTMLDocument('겹치는 계정 확인기');
      
      // HTML 구조 생성
      newDoc.documentElement.innerHTML = `<head>
  <meta charset="UTF-8">
  <title>겹치는 계정 확인기</title>
  <style>
    body { background: white; font-family: sans-serif; color: #333; padding: 30px; }
    textarea { width: 100%; height: 200px; }
    button { background-color: #888; color: white; border: none; padding: 10px 20px; font-size: 1em; margin-top: 10px; cursor: pointer; }
    button:hover { background-color: #555; }
  </style>
</head>
<body>
  <h2>당신의 팔로잉 목록</h2>
  <p>상호 맞팔 여부를 확인하려면 본인의 목록을 아래에 붙여넣으세요.</p>
  <textarea id="userInput"></textarea>
  <br />
  <button onclick="check()">겹치는 계정 확인</button>
  <h3>결과</h3>
  <pre id="result"></pre>
</body>`;

      // script 요소 생성 및 추가
      const script = newDoc.createElement('script');
      script.textContent = `
const DATA = ${JSON.stringify(encodedData)};

function getData() {
  try {
    const decoded = decodeURIComponent(atob(DATA));
    return JSON.parse(decoded);
  } catch(e) {
    return [];
  }
}

function check() {
  const userLines = document.getElementById('userInput').value.split('\\n').map(x => x.trim());
  const matches = [];
  const accounts = getData();

  for (const account of accounts) {
    if (userLines.includes(account.username)) {
      matches.push(account.name + '\\n' + account.username);
    }
  }

  document.getElementById('result').textContent = matches.join('\\n\\n') || '겹치는 계정이 없습니다.';
}

document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.key === 'u')) {
    e.preventDefault();
  }
});

setInterval(() => {
  if (window.outerHeight - window.innerHeight > 160 || window.outerWidth - window.innerWidth > 160) {
    document.body.innerHTML = '<div style="text-align:center;margin-top:200px;font-size:24px;">⚠️ 접근이 제한되었습니다.</div>';
  }
}, 500);
`;
      
      newDoc.body.appendChild(script);
      
      // HTML 문자열로 변환
      const finalHtml = '<!DOCTYPE html>' + newDoc.documentElement.outerHTML;

      // 다운로드
      const blob = new Blob([finalHtml], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const link = document.getElementById('download-link');
      link.href = url;
      link.style.display = 'inline-block';
      link.textContent = '보호된 확인기 다운로드 (checker.html)';
      
      console.log('다운로드 링크 생성 완료');
    }
  </script>
</body>
</html>
